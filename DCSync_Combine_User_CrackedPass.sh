#!/bin/bash

# Script för att matcha knäckta lösenord med användarnamn från DCSync.

# outputdata från secretsdump
# domain.se\admin:1558:aad3b434eeaad3b:000001111111:::
raw_data="dcsync.ntds"

# knäckta lösenord från hashcat
# nthash:klartextlösenord
target_data="cracked.txt"

# Define output file
combined_data="user-hash-pass.txt"

# Temporary file
temp_file="temp.txt"

# Cut the first set of data from target_data
cut -d ":" -f 1 "$target_data" > "$temp_file"

# Grep out matching lines from raw_data
grep -i -f "$temp_file" "$raw_data" | while IFS=: read -r id digits value1 value2 _; do
    # Look up corresponding word from target_data.txt
    word=$(grep -i "^$value2:" "$target_data" | cut -d ":" -f 2)
    # Write to combined_data.txt
    echo "$id:$value2:$word" >> "$combined_data"
done

# Clean up temporary file
rm "$temp_file"

echo "Combined data written to $combined_data"
